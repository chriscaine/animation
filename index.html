<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <!--
    <script>
        function load(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.responseType = 'blob';
            xhr.onload = function (e) {
                if (this.status == 200) {
                    callback(this.response);
                }
            };
            xhr.send();
        }


        var stdout = "";
        var stderr = "";
        var worker = new Worker("webservices/myWebWorker.js");

        var videoData;
        var result;
        worker.onmessage = function (e) {
            var msg = e.data;
            switch (msg.type) {
                case "ready":
                    result = worker.postMessage({// ["-i", "test.webm", "-c:v", "libvpx", "-an", "out.webm"]
                        type: "run", arguments: ["test.mp4", "-c:v", "libvpx", "-an", "out.mp4"],
                        MEMFS: [{ name: "test.mp4", data: testData }]//,
                        //{ name: "out.mp4", data : videoData }],
                    });
                    break;
                case "stdout":
                    console.info(msg.data);
                    break;
                case "stderr":
                    console.info(msg.data);
                    break;
                case "exit":
                    console.log("Process exited with code " + msg.data);
                    console.log(stdout);

                    console.log(videoData);

                    worker.terminate();
                    break;
            }
        };
        //var blob = new Blob(['blob data']);
        //FS.mkdir('/working');
        //FS.mount(WORKERFS, {
        //    blobs: [{ name: 'blob.txt', data: blob }],
        //    files: files, // Array of File objects or FileList
        //}, '/working');


    </script>

    -->


<script>
    var worker = new Worker("webservices/myWebWorker.js?521");
    worker.onmessage = function (event) {
        var message = event.data;
        if (message.type == "ready") {
          console.info("Loaded");
            worker.postMessage({
                type: 'go'
                
            })
        } else if (message.type == "stdout") {
           // console.info(message.data);
        } else if (message.type == "start") {
           // console.info("Worker has received command");
        } else if (message.type == "done") {
            console.log('done');
            worker.postMessage({ 'type': 'fetch' });
            console.log('fetch');
        } else if (message.type === 'fetch') {
            console.log('receive');
            window.result = message.data;

        }
    };
</script>


</head>
<body>

</body>
</html>
